# AI Counseling Assistant Dashboard - 유스케이스 명세서 (Use-Case Document)

---

## 목차

1. [액터 정의 (Actor Definitions)](#1-액터-정의-actor-definitions)
2. [유스케이스 시나리오 (Use Case Scenarios)](#2-유스케이스-시나리오-use-case-scenarios)
3. [주요 단계 및 이벤트 흐름 (Main Steps and Flow of Events)](#3-주요-단계-및-이벤트-흐름-main-steps-and-flow-of-events)
4. [대안 흐름 및 예외 케이스 (Alternative Flows and Edge Cases)](#4-대안-흐름-및-예외-케이스-alternative-flows-and-edge-cases)
5. [사전조건 및 사후조건 (Preconditions and Postconditions)](#5-사전조건-및-사후조건-preconditions-and-postconditions)
6. [비즈니스 규칙 및 제약사항 (Business Rules and Constraints)](#6-비즈니스-규칙-및-제약사항-business-rules-and-constraints)
7. [예외 처리 절차 (Exception Handling Procedures)](#7-예외-처리-절차-exception-handling-procedures)
8. [사용자 인터페이스 고려사항 (User Interface Considerations)](#8-사용자-인터페이스-고려사항-user-interface-considerations)
9. [데이터 요구사항 및 데이터 흐름 (Data Requirements and Data Flow)](#9-데이터-요구사항-및-데이터-흐름-data-requirements-and-data-flow)
10. [보안 및 개인정보 고려사항 (Security and Privacy Considerations)](#10-보안-및-개인정보-고려사항-security-and-privacy-considerations)

---

## 1. 액터 정의 (Actor Definitions)

### 1.1 주요 액터 (Primary Actor)

| 액터 | 역할 | 책임 | 시스템 접근 권한 |
|------|------|------|-----------------|
| **상담사 (Counselor)** | 콜센터 인바운드/아웃바운드 통화 처리 담당자 | 고객 응대, 정보 조회, 통화 마무리 및 후속 처리 | 대시보드 전체 기능, 통화 기록 조회, AI 분석 요청 |

**상담사 특성:**
- 동시에 전화 응대와 화면 조작을 수행
- 빠른 정보 검색과 정확한 고객 응대가 핵심 업무
- 개인정보 보호 규정 준수 의무
- 다양한 숙련도 (신입~경력 상담사)

### 1.2 보조 액터 (Secondary Actors)

| 액터 | 유형 | 역할 | 상호작용 방식 |
|------|------|------|--------------|
| **AI 시스템 (STT)** | 시스템 | 음성을 실시간 텍스트로 변환 | WebSocket 스트리밍 |
| **AI 시스템 (LLM)** | 시스템 | 대화 요약, 추천 스크립트 생성 | REST API 요청/응답 |
| **AI 시스템 (RAG)** | 시스템 | 컨텍스트 기반 문서 검색 및 답변 생성 | REST API 요청/응답 |
| **백엔드 서버** | 시스템 | 세션 관리, 데이터 저장, PII 마스킹 | REST API, WebSocket |
| **외부 메시징 시스템 (SMS)** | 외부 시스템 | 고객에게 SMS 발송 | REST API 연동 |
| **인증 시스템** | 시스템 | JWT 기반 사용자 인증 | OAuth/JWT |

### 1.3 액터 관계도

```
                                    ┌─────────────────┐
                                    │   인증 시스템    │
                                    └────────┬────────┘
                                             │ JWT 발급/검증
                                             │
┌─────────────┐                     ┌────────▼────────┐
│             │    UI 상호작용       │                 │
│   상담사     │◀──────────────────▶│   대시보드       │
│  (Primary)  │                     │   (시스템)       │
│             │                     │                 │
└─────────────┘                     └────────┬────────┘
                                             │
                    ┌────────────────────────┼────────────────────────┐
                    │                        │                        │
           ┌────────▼────────┐      ┌────────▼────────┐      ┌────────▼────────┐
           │   AI 시스템      │      │   백엔드 서버    │      │   SMS 시스템    │
           │ (STT/LLM/RAG)   │      │                 │      │   (External)    │
           └─────────────────┘      └─────────────────┘      └─────────────────┘
```

---

## 2. 유스케이스 시나리오 (Use Case Scenarios)

### 2.1 유스케이스 목록

| UC ID | 유스케이스명 | 우선순위 | 주요 액터 | 관련 Zone |
|-------|-------------|----------|----------|----------|
| UC-01 | 상담 세션 시작 | 필수 | 상담사 | 전체 |
| UC-02 | 실시간 대화 모니터링 | 필수 | 상담사, STT | Zone A |
| UC-03 | AI 컨텍스트 분석 요청 | 필수 | 상담사, LLM, RAG | Zone B |
| UC-04 | 통화 종료 및 마무리 | 필수 | 상담사, LLM, SMS | Zone C |
| UC-05 | 분석 히스토리 조회 | 선택 | 상담사 | Zone B |
| UC-06 | 통화 이력 검색 | 선택 | 상담사 | 이력 페이지 |
| UC-07 | 시스템 설정 변경 | 선택 | 상담사 | 설정 모달 |

### 2.2 유스케이스 다이어그램

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                        AI Counseling Assistant Dashboard                     │
│                                                                             │
│  ┌──────────────────────────────────────────────────────────────────────┐   │
│  │                                                                      │   │
│  │    ┌─────────────────┐                                              │   │
│  │    │  UC-01          │                                              │   │
│  │    │  상담 세션 시작  │◀────────────────────┐                        │   │
│  │    └────────┬────────┘                     │                        │   │
│  │             │                              │                        │   │
│  │             ▼                              │                        │   │
│  │    ┌─────────────────┐              ┌──────┴──────┐                 │   │
│  │    │  UC-02          │              │             │                 │   │
│  │    │  실시간 대화     │◀─────────────│   상담사    │                 │   │
│  │    │  모니터링       │              │  (Actor)    │                 │   │
│  │    └────────┬────────┘              │             │                 │   │
│  │             │                       └──────┬──────┘                 │   │
│  │             │ <<include>>                  │                        │   │
│  │             ▼                              │                        │   │
│  │    ┌─────────────────┐                     │                        │   │
│  │    │  UC-03          │◀────────────────────┤                        │   │
│  │    │  AI 컨텍스트     │                     │                        │   │
│  │    │  분석 요청       │                     │                        │   │
│  │    └────────┬────────┘                     │                        │   │
│  │             │                              │                        │   │
│  │             │ <<extend>>                   │                        │   │
│  │             ▼                              │                        │   │
│  │    ┌─────────────────┐                     │                        │   │
│  │    │  UC-05          │                     │                        │   │
│  │    │  분석 히스토리   │                     │                        │   │
│  │    │  조회           │                     │                        │   │
│  │    └─────────────────┘                     │                        │   │
│  │                                            │                        │   │
│  │    ┌─────────────────┐                     │                        │   │
│  │    │  UC-04          │◀────────────────────┘                        │   │
│  │    │  통화 종료 및    │                                              │   │
│  │    │  마무리         │                                              │   │
│  │    └─────────────────┘                                              │   │
│  │                                                                      │   │
│  └──────────────────────────────────────────────────────────────────────┘   │
│                                                                             │
│         ┌─────────────┐    ┌─────────────┐    ┌─────────────┐              │
│         │  STT 시스템  │    │  LLM/RAG    │    │  SMS 시스템  │              │
│         │  (Actor)    │    │  (Actor)    │    │  (Actor)    │              │
│         └─────────────┘    └─────────────┘    └─────────────┘              │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 3. 주요 단계 및 이벤트 흐름 (Main Steps and Flow of Events)

### 3.1 UC-01: 상담 세션 시작

**유스케이스 ID:** UC-01  
**유스케이스명:** 상담 세션 시작  
**주요 액터:** 상담사  
**목표:** 상담사가 시스템에 로그인하여 통화 대기 상태로 진입

#### 주요 흐름 (Main Flow)

| 단계 | 액터 | 사용자 행동 | 시스템 응답 | UI 상태 변화 |
|------|------|------------|------------|-------------|
| 1 | 상담사 | 브라우저에서 대시보드 URL 접속 | 로그인 페이지 표시 | 로그인 폼 렌더링 |
| 2 | 상담사 | 사번과 비밀번호 입력 후 "로그인" 클릭 | 인증 서버에 자격 증명 전송 | 로딩 인디케이터 표시 |
| 3 | 시스템 | - | JWT 토큰 발급 및 저장 | - |
| 4 | 시스템 | - | 대시보드 페이지로 리다이렉트 | 대시보드 레이아웃 로드 |
| 5 | 시스템 | - | WebSocket 연결 수립 시도 | 연결 상태 인디케이터 표시 |
| 6 | 시스템 | - | WebSocket 연결 성공 | Topbar에 "대기 중" 상태 표시 |
| 7 | 시스템 | - | STT 서비스 Listening 상태 진입 | Zone A "통화 대기 중" 메시지 표시 |
| 8 | 상담사 | 전화 수신 (외부 전화 시스템) | 통화 연결 이벤트 감지 | "통화 중" 상태로 전환, 타이머 시작 |

#### 상세 흐름 설명

**단계 2 상세: 로그인 처리**
```
[사용자 입력]
├── 사번: 필수 입력 (영문+숫자 조합)
├── 비밀번호: 필수 입력 (8자 이상)
└── "로그인" 버튼 클릭

[시스템 처리]
├── 입력값 유효성 검증
├── POST /api/v1/auth/login 요청
├── 응답 대기 (타임아웃: 10초)
└── JWT 토큰 로컬 스토리지 저장
```

**단계 5 상세: WebSocket 연결**
```
[시스템 처리]
├── WebSocket 서버 주소 조회
├── 연결 핸드셰이크 (JWT 토큰 포함)
├── 연결 성공 시: 세션 ID 수신
└── 연결 실패 시: 재연결 로직 (최대 3회)
```

**✅ Verification (검증 체크포인트):**
- [ ] JWT 토큰이 유효하게 저장되었는가?
- [ ] WebSocket 연결이 성공적으로 수립되었는가?
- [ ] Topbar에 "대기 중" 상태가 올바르게 표시되는가?
- [ ] Zone A에 대기 상태 메시지가 표시되는가?

---

### 3.2 UC-02: 실시간 대화 모니터링

**유스케이스 ID:** UC-02  
**유스케이스명:** 실시간 대화 모니터링  
**주요 액터:** 상담사, STT 시스템  
**목표:** 통화 중 대화 내용을 실시간으로 텍스트로 확인

#### 주요 흐름 (Main Flow)

| 단계 | 액터 | 사용자 행동 | 시스템 응답 | UI 상태 변화 |
|------|------|------------|------------|-------------|
| 1 | 시스템 | - | 통화 연결 감지, STT 스트리밍 시작 | Zone A 활성화, 첫 번째 발화 대기 |
| 2 | STT | - | 음성 청크 수신 및 변환 시작 | - |
| 3 | 시스템 | - | Interim 결과 WebSocket으로 전송 | 발화 텍스트 Light Gray로 표시 |
| 4 | 상담사 | 화면에서 Interim 텍스트 확인 | - | 텍스트가 실시간으로 업데이트 |
| 5 | 시스템 | - | Final 결과 확정 및 전송 | 텍스트 Black으로 전환, 발화자 레이블 확정 |
| 6 | 시스템 | - | 새 발화 추가 시 자동 스크롤 | 최신 메시지가 뷰포트 하단에 위치 |
| 7 | 상담사 | 과거 대화 확인 위해 스크롤 업 | 자동 스크롤 일시 중지 | "실시간으로 이동" 버튼 표시 |
| 8 | 상담사 | "실시간으로 이동" 버튼 클릭 | 최신 메시지 위치로 스크롤 | 버튼 숨김, 자동 스크롤 재개 |

#### 상세 흐름 설명

**단계 3-5 상세: STT 결과 처리**
```
[WebSocket 메시지 수신]
{
  "type": "transcript",
  "speaker": "customer",
  "text": "카드 분실 신고하려고요",
  "isFinal": false,
  "timestamp": "2024-01-15T10:30:45.123Z"
}

[UI 렌더링 규칙]
├── isFinal = false → Light Gray (#9CA3AF), 이탤릭체
├── isFinal = true  → Black (#1F2937), 일반체
├── speaker = "customer" → "[고객]" 레이블
└── speaker = "counselor" → "[상담사]" 레이블
```

**단계 6-8 상세: 스크롤 동작**
```
[자동 스크롤 조건]
IF 현재 스크롤 위치가 하단 100px 이내
   → 새 메시지 추가 시 자동 스크롤 유지
   
ELSE
   → 자동 스크롤 중지
   → "실시간으로 이동" FAB 표시
   → 뱃지에 놓친 메시지 수 표시

[Jump to Live 동작]
├── 버튼 클릭 시 smooth scroll 애니메이션
├── 최신 메시지 위치로 이동
├── 버튼 숨김 처리
└── 자동 스크롤 재개
```

**✅ Verification (검증 체크포인트):**
- [ ] Interim 텍스트가 Light Gray로 표시되는가?
- [ ] Final 텍스트가 Black으로 전환되는가?
- [ ] 발화자 레이블이 정확히 구분되는가?
- [ ] 스크롤 업 시 "실시간으로 이동" 버튼이 나타나는가?
- [ ] 버튼 클릭 시 최신 위치로 스무스하게 이동하는가?

---

### 3.3 UC-03: AI 컨텍스트 분석 요청

**유스케이스 ID:** UC-03  
**유스케이스명:** AI 컨텍스트 분석 요청  
**주요 액터:** 상담사, LLM, RAG 시스템  
**목표:** 현재 대화 맥락에 맞는 정보와 추천 스크립트 획득

#### 주요 흐름 (Main Flow)

| 단계 | 액터 | 사용자 행동 | 시스템 응답 | UI 상태 변화 |
|------|------|------------|------------|-------------|
| 1 | 상담사 | "AI 컨텍스트 분석" FAB 클릭 또는 `Ctrl+Shift+A` | 분석 요청 프로세스 시작 | FAB 상태 → Loading |
| 2 | 시스템 | - | 최근 대화 컨텍스트 추출 (3-5분/10턴) | - |
| 3 | 시스템 | - | 컨텍스트 내 PII 패턴 탐지 및 마스킹 | - |
| 4 | 시스템 | - | RAG 서버에 분석 요청 전송 | Zone B에 Skeleton UI 표시 |
| 5 | 상담사 | Skeleton UI 확인하며 대기 | - | 1-3초 로딩 상태 |
| 6 | 시스템 | - | RAG 응답 수신 (요약, 문서, 스크립트) | Skeleton → 실제 콘텐츠 전환 |
| 7 | 상담사 | 자동 생성된 검색 쿼리 확인 | - | 쿼리 영역 표시 (편집 가능) |
| 8 | 상담사 | 요약 답변 및 관련 문서 확인 | - | 각 섹션 순차 렌더링 |
| 9 | 상담사 | 추천 스크립트 확인 | - | 스크립트 영역 + "복사" 버튼 |
| 10 | 상담사 | "복사" 버튼 클릭 (선택) | 클립보드에 스크립트 복사 | Toast: "스크립트가 복사되었습니다" |

#### 상세 흐름 설명

**단계 2-3 상세: 컨텍스트 추출 및 PII 마스킹**
```
[컨텍스트 추출 규칙]
├── 시간 기준: 최근 3분 (설정 가능: 1-5분)
├── 턴 기준: 최근 10턴 (설정 가능: 5-20턴)
├── 적용 규칙: 시간/턴 중 먼저 도달하는 조건
└── 추출 데이터: speaker, text, timestamp

[PII 마스킹 처리]
├── 전화번호: 010-****-5678
├── 카드번호: ****-****-****-1234
├── 주민번호: 880101-*******
├── 이름: 홍** (첫 글자만 유지)
└── 주소: 서울시 강남구 ***
```

**단계 4 상세: API 요청**
```
POST /api/v1/ai/context-analysis
Authorization: Bearer {jwt_token}

Request Body:
{
  "sessionId": "session-uuid-12345",
  "context": [
    {
      "speaker": "customer",
      "text": "카드 분실 신고하려고 하는데요",
      "timestamp": "2024-01-15T10:30:45.123Z"
    },
    {
      "speaker": "counselor",
      "text": "네, 고객님. 본인 확인 후 진행해 드리겠습니다",
      "timestamp": "2024-01-15T10:30:52.456Z"
    }
    // ... 추가 턴
  ],
  "customQuery": null  // 사용자 수정 쿼리 (초기 요청 시 null)
}
```

**단계 6 상세: API 응답 처리**
```
Response Body:
{
  "generatedQuery": "카드 분실 신고 절차",
  "summary": "카드 분실 신고는 다음 절차로 진행됩니다:\n1. 본인 확인...",
  "documents": [
    {
      "title": "카드 분실/도난 처리 매뉴얼 v2.3",
      "url": "/docs/card-loss-manual-v2.3.pdf",
      "relevance": 0.95
    },
    {
      "title": "재발급 수수료 정책 (2024.01 개정)",
      "url": "/docs/reissue-fee-policy-2024.pdf",
      "relevance": 0.87
    }
  ],
  "recommendedScript": "고객님, 불편을 드려 죄송합니다. 본인 확인 후 바로 카드 사용을 정지해 드리겠습니다..."
}
```

**✅ Verification (검증 체크포인트):**
- [ ] FAB 클릭 시 즉시 Loading 상태로 전환되는가?
- [ ] Skeleton UI가 올바르게 표시되는가?
- [ ] PII가 마스킹된 상태로 서버에 전송되는가?
- [ ] 응답 수신 후 3개 섹션(요약/문서/스크립트)이 모두 표시되는가?
- [ ] 검색 쿼리가 편집 가능한 상태인가?
- [ ] 스크립트 복사 시 Toast가 표시되는가?

---

### 3.4 UC-03-A: 검색 쿼리 수정 후 재분석 (UC-03 확장)

**유스케이스 ID:** UC-03-A  
**유스케이스명:** 검색 쿼리 수정 후 재분석  
**선행 조건:** UC-03 완료 (AI 분석 결과 표시 상태)

#### 주요 흐름 (Main Flow)

| 단계 | 액터 | 사용자 행동 | 시스템 응답 | UI 상태 변화 |
|------|------|------------|------------|-------------|
| 1 | 상담사 | 검색 쿼리 영역의 텍스트 클릭 | 편집 모드 활성화 | 쿼리 입력 필드로 전환 |
| 2 | 상담사 | 쿼리 내용 수정 (예: "해외 카드 분실 보상 한도") | - | 입력 필드에 텍스트 반영 |
| 3 | 상담사 | "다시 분석" 버튼 클릭 | 수정된 쿼리로 재분석 요청 | 결과 영역 Skeleton UI 전환 |
| 4 | 시스템 | - | RAG 서버에 재분석 요청 | - |
| 5 | 시스템 | - | 새로운 결과 수신 | Skeleton → 새 콘텐츠 전환 |
| 6 | 상담사 | 새 결과 확인 | - | 이전 결과 대체 |

**✅ Verification (검증 체크포인트):**
- [ ] 쿼리 영역 클릭 시 편집 모드로 전환되는가?
- [ ] "다시 분석" 버튼이 활성화되는가?
- [ ] 재분석 결과가 이전 결과를 완전히 대체하는가?

---

### 3.5 UC-04: 통화 종료 및 마무리

**유스케이스 ID:** UC-04  
**유스케이스명:** 통화 종료 및 마무리  
**주요 액터:** 상담사, LLM, SMS 시스템  
**목표:** 통화 요약 생성, SMS 발송, 세션 종료

#### 주요 흐름 (Main Flow)

| 단계 | 액터 | 사용자 행동 | 시스템 응답 | UI 상태 변화 |
|------|------|------------|------------|-------------|
| 1 | 상담사 | "통화 종료" 버튼 클릭 | 종료 프로세스 시작 | Topbar "마무리 중" 상태 전환 |
| 2 | 시스템 | - | Zone C 마무리 모달 표시 | 모달 오버레이 렌더링 |
| 3 | 시스템 | - | 전체 대화 기반 요약 생성 요청 | 요약 영역 Skeleton UI 표시 |
| 4 | 시스템 | - | LLM 응답 수신 (PII 마스킹된 요약) | 요약 텍스트 표시, 보안 배지 "🔒 보안 처리 완료" |
| 5 | 상담사 | 요약 내용 확인 | - | 요약 영역 읽기 모드 |
| 6 | 상담사 | "편집" 버튼 클릭 (선택) | 편집 모드 활성화 | 텍스트 에디터로 전환 |
| 7 | 상담사 | 요약 수정 후 저장 (선택) | 수정 내용 임시 저장 | 읽기 모드로 복귀 |
| 8 | 상담사 | SMS 미리보기 확인 | - | SMS 섹션 표시 (비즈니스 안전 데이터) |
| 9 | 상담사 | SMS 발송 체크박스 선택 | - | 체크 상태 표시 |
| 10 | 상담사 | "저장 및 완료" 버튼 클릭 | 데이터 저장 + SMS 발송 요청 | 버튼 로딩 상태 |
| 11 | 시스템 | - | SMS 발송 성공 확인 | Toast: "통화가 완료되었습니다" |
| 12 | 시스템 | - | 모달 닫힘, 대시보드 초기화 | Topbar "대기 중" 상태 복귀 |

#### 상세 흐름 설명

**단계 3-4 상세: 요약 생성**
```
POST /api/v1/ai/call-summary
Authorization: Bearer {jwt_token}

Request Body:
{
  "sessionId": "session-uuid-12345",
  "fullTranscript": [
    // 전체 대화 내용 (PII 마스킹 완료 상태)
  ]
}

Response Body:
{
  "summary": "고객(홍**)의 카드 분실 신고 건.\n- 분실 일시: 2024-01-15 오전\n- 카드번호: ****-****-****-1234\n- 조치: 즉시 사용 정지 완료\n- 재발급 신청 완료 (배송 예정: 3영업일)",
  "piiMasked": true,
  "securityProcessedAt": "2024-01-15T10:45:30.000Z"
}
```

**단계 8-9 상세: SMS 미리보기**
```
[SMS 미리보기 데이터]
├── 수신번호: 010-****-5678 (마스킹 표시)
├── 발송 시 실제 번호: 010-1234-5678 (시스템 내부)
└── 메시지 내용:
    "[OO카드] 홍길동 고객님, 카드 분실 신고가 정상 처리되었습니다.
     재발급 카드는 3영업일 이내 등록 주소로 배송됩니다.
     문의: 1588-XXXX"
```

**단계 10-11 상세: 저장 및 발송**
```
POST /api/v1/session/complete
Authorization: Bearer {jwt_token}

Request Body:
{
  "sessionId": "session-uuid-12345",
  "summary": "최종 요약 텍스트 (편집된 경우 수정본)",
  "sendSms": true,
  "smsContent": "SMS 메시지 내용",
  "smsRecipient": "010-1234-5678"  // 원본 번호 (서버에서만 처리)
}

Response Body:
{
  "success": true,
  "sessionClosedAt": "2024-01-15T10:47:00.000Z",
  "smsSentAt": "2024-01-15T10:47:01.234Z",
  "smsStatus": "delivered"
}
```

**✅ Verification (검증 체크포인트):**
- [ ] 모달이 올바르게 표시되는가?
- [ ] 요약에 PII가 마스킹되어 있는가?
- [ ] 보안 배지가 "🔒 보안 처리 완료"로 표시되는가?
- [ ] SMS 미리보기에 비즈니스 안전 데이터만 표시되는가?
- [ ] 발송 완료 후 대시보드가 대기 상태로 초기화되는가?

---

### 3.6 UC-04-A: 고객이 먼저 통화 종료 (UC-04 대안 흐름)

**유스케이스 ID:** UC-04-A  
**유스케이스명:** 고객이 먼저 통화 종료  
**트리거:** 시스템이 고객의 통화 종료 감지

#### 대안 흐름 (Alternative Flow)

| 단계 | 액터 | 사용자 행동 | 시스템 응답 | UI 상태 변화 |
|------|------|------------|------------|-------------|
| 1 | 시스템 | - | 고객 통화 종료 이벤트 감지 | STT 스트림 중지 |
| 2 | 시스템 | - | 자동으로 Zone C 모달 팝업 | 모달 표시 + 알림음 (선택) |
| 3 | 상담사 | 모달 확인 | - | 요약 생성 자동 시작 |
| 4 | - | - | UC-04 단계 4부터 동일하게 진행 | - |

---

## 4. 대안 흐름 및 예외 케이스 (Alternative Flows and Edge Cases)

### 4.1 UC-02 대안 흐름: STT 지연/오류

#### 4.1.1 AF-02-A: STT 일시적 지연

| 조건 | 상황 설명 |
|------|----------|
| **트리거** | STT 결과가 2초 이상 지연 |
| **빈도** | 네트워크 혼잡 시 발생 가능 |

| 단계 | 시스템 응답 | UI 상태 변화 |
|------|------------|-------------|
| 1 | 지연 감지 (마지막 메시지 후 2초 무응답) | Zone A 하단에 "음성 처리 중..." 인디케이터 표시 |
| 2 | 지연 지속 시 (5초 이상) | 인디케이터 색상 Yellow로 변경 |
| 3 | 정상화 시 | 밀린 메시지 순차 표시, 인디케이터 숨김 |

#### 4.1.2 AF-02-B: STT 부분 오디오 손실

| 조건 | 상황 설명 |
|------|----------|
| **트리거** | 오디오 스트림 일부 패킷 손실 |
| **빈도** | 희귀 (네트워크 불안정 시) |

| 단계 | 시스템 응답 | UI 상태 변화 |
|------|------------|-------------|
| 1 | 손실 감지 (시퀀스 번호 불연속) | 해당 구간에 "[일부 음성 누락]" 플레이스홀더 삽입 |
| 2 | 전사 계속 진행 | 다음 인식 결과부터 정상 표시 |

### 4.2 UC-03 대안 흐름: AI 분석 지연/실패

#### 4.2.1 AF-03-A: AI 응답 지연 (3초 초과)

| 조건 | 상황 설명 |
|------|----------|
| **트리거** | RAG 응답이 3초 초과 |
| **허용 범위** | 최대 10초까지 대기 |

| 단계 | 시스템 응답 | UI 상태 변화 |
|------|------------|-------------|
| 1 | 3초 경과 감지 | Skeleton UI에 "분석 중... 잠시만 기다려 주세요" 텍스트 추가 |
| 2 | 5초 경과 | 프로그레스 바 표시 (불확정 상태) |
| 3 | 10초 내 응답 수신 | 정상 결과 표시 |

#### 4.2.2 AF-03-B: AI 응답 타임아웃 (10초 초과)

| 조건 | 상황 설명 |
|------|----------|
| **트리거** | RAG 응답이 10초 초과 |
| **결과** | 분석 실패 처리 |

| 단계 | 시스템 응답 | UI 상태 변화 |
|------|------------|-------------|
| 1 | 10초 타임아웃 발생 | Skeleton → 에러 메시지로 전환 |
| 2 | 에러 UI 표시 | "분석 요청 시간이 초과되었습니다" + "다시 시도" 버튼 |
| 3 | 상담사가 "다시 시도" 클릭 | 분석 재요청 (UC-03 단계 1부터) |

#### 4.2.3 AF-03-C: 부적절한 RAG 검색 결과

| 조건 | 상황 설명 |
|------|----------|
| **트리거** | 관련 문서 relevance score < 0.5 |
| **결과** | 저신뢰도 경고 표시 |

| 단계 | 시스템 응답 | UI 상태 변화 |
|------|------------|-------------|
| 1 | 저신뢰도 결과 감지 | 결과 표시 + 상단에 경고 배너 |
| 2 | 경고 내용 | "검색 결과의 관련성이 낮을 수 있습니다. 검색어를 수정해 보세요." |
| 3 | 쿼리 수정 유도 | 검색 쿼리 영역 하이라이트 |

### 4.3 UC-04 대안 흐름: 마무리 과정 오류

#### 4.3.1 AF-04-A: 요약 생성 실패

| 조건 | 상황 설명 |
|------|----------|
| **트리거** | LLM 서버 오류 또는 타임아웃 |
| **결과** | 수동 요약 작성 모드 |

| 단계 | 시스템 응답 | UI 상태 변화 |
|------|------------|-------------|
| 1 | 요약 생성 실패 | Skeleton → 에러 메시지 + 빈 텍스트 에디터 |
| 2 | 안내 메시지 | "자동 요약 생성에 실패했습니다. 직접 작성해 주세요." |
| 3 | 상담사 수동 작성 | 텍스트 에디터에 직접 입력 가능 |

#### 4.3.2 AF-04-B: SMS 발송 실패

| 조건 | 상황 설명 |
|------|----------|
| **트리거** | SMS 게이트웨이 오류 |
| **결과** | 재시도 또는 나중에 발송 옵션 |

| 단계 | 시스템 응답 | UI 상태 변화 |
|------|------------|-------------|
| 1 | SMS 발송 실패 | Toast (Error): "SMS 발송에 실패했습니다" |
| 2 | 옵션 제공 | 모달 내 "재시도" / "나중에 발송" / "SMS 없이 완료" 버튼 |
| 3-A | 상담사 "재시도" 선택 | SMS 재발송 시도 |
| 3-B | 상담사 "나중에 발송" 선택 | 발송 대기열에 추가, 세션 종료 |
| 3-C | 상담사 "SMS 없이 완료" 선택 | SMS 미발송 상태로 세션 종료 |

#### 4.3.3 AF-04-C: 네트워크 중단 (마무리 중)

| 조건 | 상황 설명 |
|------|----------|
| **트리거** | 저장/발송 중 네트워크 연결 끊김 |
| **결과** | 로컬 임시 저장 + 복구 안내 |

| 단계 | 시스템 응답 | UI 상태 변화 |
|------|------------|-------------|
| 1 | 네트워크 끊김 감지 | 모달 내 연결 오류 배너 표시 |
| 2 | 임시 저장 | 작성 중인 데이터 로컬 스토리지 저장 |
| 3 | 재연결 감지 | 배너에 "연결 복구됨 - 저장 계속" 표시 |
| 4 | 자동 재시도 | 중단된 저장/발송 요청 재실행 |

### 4.4 예외 케이스: PII 관련

#### 4.4.1 EC-01: 예상치 못한 PII 패턴 감지

| 조건 | 상황 설명 |
|------|----------|
| **트리거** | 기존 정규식으로 탐지되지 않는 새로운 PII 패턴 |
| **예시** | 여권번호, 외국인등록번호 등 |

| 단계 | 시스템 응답 | UI 상태 변화 |
|------|------------|-------------|
| 1 | 백엔드 2차 검증에서 잠재 PII 감지 | 보안 배지 "⚠️ 보안 검토 필요" (Yellow) |
| 2 | 경고 메시지 | 요약 영역 상단에 "민감 정보가 포함되어 있을 수 있습니다. 확인 후 진행하세요." |
| 3 | 상담사 수동 확인 | 해당 부분 하이라이트, 상담사가 직접 마스킹 편집 |

#### 4.4.2 EC-02: PII 마스킹 미적용 데이터 전송 시도

| 조건 | 상황 설명 |
|------|----------|
| **트리거** | 프론트엔드 마스킹 우회 시도 (버그 또는 악의적) |
| **결과** | 백엔드에서 요청 거부 |

| 단계 | 시스템 응답 | UI 상태 변화 |
|------|------------|-------------|
| 1 | 백엔드에서 원본 PII 감지 | API 요청 거부 (HTTP 422) |
| 2 | 에러 응답 | "보안 처리되지 않은 데이터가 감지되었습니다" |
| 3 | 강제 마스킹 후 재전송 | 백엔드에서 자동 마스킹 후 처리 (폴백) |
| 4 | 보안 로그 기록 | 인시던트 로그에 이벤트 기록 |

---

## 5. 사전조건 및 사후조건 (Preconditions and Postconditions)

### 5.1 UC-01: 상담 세션 시작

| 구분 | 조건 |
|------|------|
| **사전조건 (Preconditions)** | |
| PC-01-01 | 상담사가 유효한 계정 정보(사번, 비밀번호)를 보유 |
| PC-01-02 | 네트워크 연결이 정상 상태 |
| PC-01-03 | 브라우저가 WebSocket을 지원 (Chrome, Edge, Firefox 최신 버전) |
| PC-01-04 | 백엔드 서버 및 STT 서비스가 가용 상태 |
| **사후조건 (Postconditions)** | |
| PO-01-01 | 상담사가 인증된 세션 보유 (JWT 토큰 유효) |
| PO-01-02 | WebSocket 연결이 수립되어 STT 스트리밍 가능 |
| PO-01-03 | 대시보드가 "대기 중" 상태로 표시 |
| PO-01-04 | 상담사 로그인 이벤트가 감사 로그에 기록 |

### 5.2 UC-02: 실시간 대화 모니터링

| 구분 | 조건 |
|------|------|
| **사전조건 (Preconditions)** | |
| PC-02-01 | UC-01 완료 (세션 시작됨) |
| PC-02-02 | 통화가 연결된 상태 |
| PC-02-03 | STT 서비스가 음성 입력을 수신 중 |
| **사후조건 (Postconditions)** | |
| PO-02-01 | 모든 발화가 시간순으로 Zone A에 표시 |
| PO-02-02 | 발화자가 정확히 구분되어 레이블링 |
| PO-02-03 | 전사 내용이 세션 메모리에 임시 저장 |

### 5.3 UC-03: AI 컨텍스트 분석 요청

| 구분 | 조건 |
|------|------|
| **사전조건 (Preconditions)** | |
| PC-03-01 | UC-02 진행 중 (통화 중 상태) |
| PC-03-02 | 최소 1턴 이상의 대화 기록 존재 |
| PC-03-03 | RAG/LLM 서비스가 가용 상태 |
| **사후조건 (Postconditions)** | |
| PO-03-01 | Zone B에 분석 결과(요약, 문서, 스크립트) 표시 |
| PO-03-02 | 분석 요청 이력이 세션 히스토리에 저장 |
| PO-03-03 | AI 사용 로그가 기록됨 (상담사 ID, 시간, 쿼리) |

### 5.4 UC-04: 통화 종료 및 마무리

| 구분 | 조건 |
|------|------|
| **사전조건 (Preconditions)** | |
| PC-04-01 | UC-02 완료 또는 진행 중 (대화 기록 존재) |
| PC-04-02 | 상담사가 통화 종료 의사 결정 또는 고객이 먼저 종료 |
| **사후조건 (Postconditions)** | |
| PO-04-01 | 통화 요약이 생성되어 DB에 저장 |
| PO-04-02 | SMS 발송 시 발송 기록이 저장 |
| PO-04-03 | 세션이 정상 종료되어 대기 상태로 복귀 |
| PO-04-04 | 전사 내용, 요약, AI 사용 이력이 영구 저장 |
| PO-04-05 | 감사 로그에 세션 종료 이벤트 기록 |

---

## 6. 비즈니스 규칙 및 제약사항 (Business Rules and Constraints)

### 6.1 AI 시스템 관련 규칙

| 규칙 ID | 규칙명 | 설명 | 위반 시 처리 |
|---------|--------|------|-------------|
| BR-AI-01 | **AI 수동 트리거 원칙** | AI 분석은 상담사의 명시적 요청(FAB 클릭, 단축키)에 의해서만 실행됨. 자동 트리거 절대 불가. | 자동 트리거 시도 시 시스템 경고 로그 |
| BR-AI-02 | **컨텍스트 범위 제한** | AI에 전송되는 대화 컨텍스트는 최대 5분 또는 20턴으로 제한 | 초과 시 오래된 데이터 자동 제외 |
| BR-AI-03 | **AI 응답 타임아웃** | AI 응답 대기 시간은 최대 10초. 초과 시 실패 처리 | 타임아웃 시 에러 UI 표시, 재시도 옵션 제공 |
| BR-AI-04 | **AI 결과 편집 불가** | AI가 생성한 요약/스크립트 원본은 수정 불가. 상담사가 편집한 버전은 별도 저장 | 원본과 편집본 모두 기록 |

### 6.2 개인정보 관련 규칙

| 규칙 ID | 규칙명 | 설명 | 위반 시 처리 |
|---------|--------|------|-------------|
| BR-PII-01 | **PII 사전 마스킹 원칙** | 모든 데이터는 AI 모델 전송 전 PII 마스킹 필수 | 마스킹 미적용 시 요청 거부 |
| BR-PII-02 | **이중 검증** | 프론트엔드 마스킹 + 백엔드 재검증 2단계 적용 | 불일치 시 백엔드 강제 마스킹 + 인시던트 로그 |
| BR-PII-03 | **원본 데이터 접근 제한** | 마스킹 해제된 원본 데이터는 SMS 발송 등 필수 목적에만 서버 측에서 사용 | 클라이언트에 원본 전송 금지 |
| BR-PII-04 | **보안 상태 시각화** | PII 처리 상태는 항상 UI에 명시적으로 표시 | 보안 배지 누락 시 시스템 경고 |

### 6.3 상담사 권한 관련 규칙

| 규칙 ID | 규칙명 | 설명 | 위반 시 처리 |
|---------|--------|------|-------------|
| BR-AUTH-01 | **최종 발송 권한** | 모든 외부 커뮤니케이션(SMS)은 상담사의 명시적 확인 후에만 발송 | 자동 발송 기능 비활성화 |
| BR-AUTH-02 | **요약 편집 권한** | 상담사는 AI 생성 요약을 자유롭게 편집 가능 | 편집 이력 별도 저장 |
| BR-AUTH-03 | **세션 종료 권한** | 세션 종료는 상담사만 가능 (시스템 자동 종료 없음, 단 고객 종료 시 마무리 모달 자동 표시) | - |

### 6.4 데이터 저장 관련 규칙

| 규칙 ID | 규칙명 | 설명 | 위반 시 처리 |
|---------|--------|------|-------------|
| BR-DATA-01 | **세션 완료 필수** | 통화 데이터는 세션이 정상 종료된 경우에만 영구 저장 | 비정상 종료 시 임시 데이터 24시간 후 자동 삭제 |
| BR-DATA-02 | **감사 로그 필수** | 모든 주요 이벤트(로그인, AI 요청, 세션 종료)는 감사 로그에 기록 | 로그 기록 실패 시 해당 작업 보류 |
| BR-DATA-03 | **데이터 보존 기간** | 통화 기록은 법적 요구사항에 따라 최소 3년 보존 | 보존 기간 내 삭제 불가 |

### 6.5 시스템 상태 관련 규칙

| 규칙 ID | 규칙명 | 설명 | 위반 시 처리 |
|---------|--------|------|-------------|
| BR-STATE-01 | **상태 명시적 표시** | 시스템 상태(Listening/Thinking/Secured)는 항상 UI에 표시 | 상태 불명확 시 기본값 "Unknown" 표시 |
| BR-STATE-02 | **통화 중 페이지 이탈 제한** | 통화 중에는 페이지 새로고침/이탈 시 경고 표시 | 확인 다이얼로그 표시 후 사용자 선택 |
| BR-STATE-03 | **세션 타임아웃** | 30분 무활동 시 세션 자동 만료 (통화 중 제외) | 재로그인 필요 |

---

## 7. 예외 처리 절차 (Exception Handling Procedures)

### 7.1 네트워크 관련 예외

| 예외 코드 | 예외 상황 | 감지 방법 | 시스템 응답 | 사용자 안내 | 복구 절차 |
|----------|----------|----------|------------|------------|----------|
| EX-NET-01 | WebSocket 연결 끊김 | heartbeat 미응답 3회 | 자동 재연결 시도 (최대 3회) | Zone A 상단 "연결 복구 중..." 배너 | 재연결 성공 시 배너 제거, 실패 시 수동 새로고침 안내 |
| EX-NET-02 | API 요청 타임아웃 | 10초 무응답 | 요청 취소 + 에러 처리 | "요청 시간이 초과되었습니다" Toast | "다시 시도" 버튼 제공 |
| EX-NET-03 | 오프라인 전환 | navigator.onLine 이벤트 | 모든 요청 일시 중단 | 전체 화면 오프라인 오버레이 | 온라인 복구 시 자동 재개 |

### 7.2 인증 관련 예외

| 예외 코드 | 예외 상황 | 감지 방법 | 시스템 응답 | 사용자 안내 | 복구 절차 |
|----------|----------|----------|------------|------------|----------|
| EX-AUTH-01 | JWT 토큰 만료 | API 401 응답 | 리프레시 토큰으로 갱신 시도 | (백그라운드 처리, 사용자 인지 없음) | 갱신 실패 시 EX-AUTH-02로 전환 |
| EX-AUTH-02 | 세션 완전 만료 | 리프레시 토큰 만료 | 로그아웃 처리 | 재로그인 모달 표시 | 로그인 후 이전 상태 복원 시도 |
| EX-AUTH-03 | 동시 로그인 감지 | 서버 세션 충돌 | 현재 세션 무효화 | "다른 기기에서 로그인됨" 알림 | 재로그인 필요 |

### 7.3 AI 서비스 관련 예외

| 예외 코드 | 예외 상황 | 감지 방법 | 시스템 응답 | 사용자 안내 | 복구 절차 |
|----------|----------|----------|------------|------------|----------|
| EX-AI-01 | STT 서비스 다운 | WebSocket 연결 실패 | 폴백 모드 진입 | "음성 인식 서비스 점검 중" 배너 | 서비스 복구 시 자동 재연결 |
| EX-AI-02 | RAG 서비스 다운 | API 503 응답 | AI 분석 기능 비활성화 | FAB 버튼 비활성화 + 툴팁 "서비스 점검 중" | 서비스 복구 시 자동 활성화 |
| EX-AI-03 | LLM 응답 오류 | 비정상 JSON 응답 | 파싱 에러 처리 | "분석 결과를 처리할 수 없습니다" | 재시도 또는 수동 작성 안내 |
| EX-AI-04 | RAG 결과 없음 | 빈 documents 배열 | 부분 결과 표시 | "관련 문서를 찾지 못했습니다" | 검색어 수정 유도 |

### 7.4 데이터 관련 예외

| 예외 코드 | 예외 상황 | 감지 방법 | 시스템 응답 | 사용자 안내 | 복구 절차 |
|----------|----------|----------|------------|------------|----------|
| EX-DATA-01 | 저장 실패 | API 500 응답 | 로컬 임시 저장 | "저장에 실패했습니다. 재시도 중..." | 자동 재시도 (최대 3회) 후 수동 저장 안내 |
| EX-DATA-02 | PII 마스킹 실패 | 정규식 처리 오류 | 요청 중단 | "보안 처리 중 오류 발생" | 페이지 새로고침 후 재시도 |
| EX-DATA-03 | 데이터 동기화 충돌 | 버전 불일치 | 최신 데이터 로드 | "데이터가 업데이트되었습니다" | 현재 작업 내용 병합 또는 덮어쓰기 선택 |

### 7.5 외부 시스템 관련 예외

| 예외 코드 | 예외 상황 | 감지 방법 | 시스템 응답 | 사용자 안내 | 복구 절차 |
|----------|----------|----------|------------|------------|----------|
| EX-EXT-01 | SMS 게이트웨이 오류 | 발송 API 실패 | 발송 대기열 저장 | "SMS 발송 지연. 나중에 발송됩니다" | 백그라운드 재시도 또는 수동 재발송 |
| EX-EXT-02 | SMS 수신번호 오류 | 잘못된 번호 형식 | 발송 거부 | "수신번호를 확인해 주세요" | 번호 수정 후 재발송 |

### 7.6 예외 처리 흐름도

```
┌─────────────────────────────────────────────────────────────────────┐
│                        예외 발생 감지                                │
└──────────────────────────────┬──────────────────────────────────────┘
                               │
                               ▼
                    ┌─────────────────────┐
                    │ 예외 유형 분류       │
                    └──────────┬──────────┘
                               │
         ┌─────────────────────┼─────────────────────┐
         │                     │                     │
         ▼                     ▼                     ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ 자동 복구 가능   │  │ 사용자 개입 필요 │  │ 치명적 오류     │
│ (재시도, 재연결) │  │ (확인, 선택)    │  │ (시스템 중단)   │
└────────┬────────┘  └────────┬────────┘  └────────┬────────┘
         │                    │                    │
         ▼                    ▼                    ▼
┌─────────────────┐  ┌─────────────────┐  ┌─────────────────┐
│ 백그라운드 처리  │  │ UI 피드백 표시  │  │ 에러 페이지     │
│ (사용자 무인지) │  │ (모달, Toast)   │  │ 또는 강제 로그아웃│
└────────┬────────┘  └────────┬────────┘  └────────┬────────┘
         │                    │                    │
         └────────────────────┼────────────────────┘
                              │
                              ▼
                    ┌─────────────────────┐
                    │ 에러 로그 기록       │
                    │ (원인, 시간, 상태)   │
                    └─────────────────────┘
```

---

## 8. 사용자 인터페이스 고려사항 (User Interface Considerations)

### 8.1 Zone A: 실시간 대화 스트림 UI

#### 8.1.1 상태별 UI 변화

| 상태 | UI 요소 | 시각적 표현 |
|------|---------|------------|
| **대기 중** | Empty State | 중앙에 "통화를 기다리는 중입니다" 메시지 + 아이콘 |
| **통화 중 (정상)** | 전사 목록 | 발화 블록이 시간순으로 쌓임, 최신 메시지 자동 스크롤 |
| **통화 중 (STT 지연)** | 지연 인디케이터 | 하단에 "음성 처리 중..." 애니메이션 |
| **통화 중 (스크롤 업)** | Jump to Live FAB | 우하단에 "실시간으로 이동 (N)" 버튼 + 놓친 메시지 수 |
| **통화 종료** | 정지 상태 | 마지막 메시지에 "통화 종료" 구분선 표시 |

#### 8.1.2 발화 블록 UI 명세

```
┌─────────────────────────────────────────────────────────────┐
│  ┌─────────────────────────────────────────────────────┐   │
│  │  10:32:15  [고객]                                   │   │
│  │  ──────────────────────────────────────────────────  │   │
│  │  카드가 갑자기 결제가 안 되는데 확인해 주실 수 있나요?  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  10:32:22  [상담사]                                 │   │
│  │  ──────────────────────────────────────────────────  │   │
│  │  네, 고객님. 본인 확인 후 바로 확인해 드리겠습니다.    │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                            │
│  ┌─────────────────────────────────────────────────────┐   │
│  │  10:32:28  [고객]                      (Interim)    │   │◀─ Light Gray
│  │  ──────────────────────────────────────────────────  │   │   + Italic
│  │  제 생년월일은 팔팔년 일월 일일이고...                 │   │
│  └─────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────┘
```

| 요소 | 스타일 | 값 |
|------|--------|-----|
| 타임스탬프 | Color, Font Size | `#6B7280`, 12px |
| 발화자 레이블 (고객) | Color, Font Weight | `#1F2937`, Bold |
| 발화자 레이블 (상담사) | Color, Font Weight | `#2563EB`, Bold |
| 발화 텍스트 (Final) | Color | `#1F2937` |
| 발화 텍스트 (Interim) | Color, Style | `#9CA3AF`, Italic |
| 블록 간격 | Margin | 12px |
| 블록 패딩 | Padding | 16px |

### 8.2 Zone B: AI 인텔리전스 패널 UI

#### 8.2.1 상태별 UI 변화

| 상태 | UI 요소 | 시각적 표현 |
|------|---------|------------|
| **초기 (분석 전)** | Empty State | "AI 분석 버튼을 눌러 정보를 검색하세요" 안내 |
| **로딩 중** | Skeleton UI | 각 섹션에 shimmer 애니메이션 적용된 플레이스홀더 |
| **결과 표시** | 콘텐츠 | 쿼리 → 요약 → 문서 → 스크립트 순서로 표시 |
| **에러** | Error State | 에러 메시지 + "다시 시도" 버튼 |
| **부분 성공** | 콘텐츠 + 경고 | 결과 표시 + 상단 경고 배너 |

#### 8.2.2 Skeleton UI 명세

```
┌─────────────────────────────────────────┐
│  🔍 검색 쿼리                           │
│  ┌─────────────────────────────────┐   │
│  │ ████████████████░░░░░░░░░░░░░░  │   │◀─ Shimmer Animation
│  └─────────────────────────────────┘   │
├─────────────────────────────────────────┤
│  📋 요약 답변                           │
│  ┌─────────────────────────────────┐   │
│  │ ████████████████████████░░░░░░  │   │
│  │ ██████████████░░░░░░░░░░░░░░░░  │   │
│  │ ████████████████████░░░░░░░░░░  │   │
│  └─────────────────────────────────┘   │
├─────────────────────────────────────────┤
│  📄 관련 문서                           │
│  ┌─────────────────────────────────┐   │
│  │ • █████████████████░░░░░░░░░░░  │   │
│  │ • ████████████░░░░░░░░░░░░░░░░  │   │
│  └─────────────────────────────────┘   │
├─────────────────────────────────────────┤
│  💬 추천 스크립트                       │
│  ┌─────────────────────────────────┐   │
│  │ ████████████████████████████░░  │   │
│  │ ██████████████████░░░░░░░░░░░░  │   │
│  │ ████████████████████████░░░░░░  │   │
│  │ ██████████░░░░░░░░░░░░░░░░░░░░  │   │
│  └─────────────────────────────────┘   │
└─────────────────────────────────────────┘

Shimmer Animation: 
- Direction: Left → Right
- Duration: 1.5s
- Easing: ease-in-out
- Background: linear-gradient(90deg, #E5E7EB 25%, #F3F4F6 50%, #E5E7EB 75%)
```

### 8.3 Zone C: 마무리 모달 UI

#### 8.3.1 상태별 UI 변화

| 상태 | UI 요소 | 시각적 표현 |
|------|---------|------------|
| **요약 생성 중** | Skeleton | 요약 영역 Skeleton + "요약 생성 중..." 텍스트 |
| **요약 완료** | 요약 표시 | 마스킹된 요약 텍스트 + 보안 배지 (Green) |
| **요약 실패** | Error + 빈 에디터 | 에러 메시지 + 직접 작성 안내 |
| **편집 모드** | 텍스트 에디터 | 요약/SMS 내용 편집 가능 상태 |
| **발송 중** | 로딩 | "저장 및 완료" 버튼 로딩 상태 |
| **완료** | 닫힘 | 모달 닫힘 + 성공 Toast |

#### 8.3.2 보안 배지 명세

| 상태 | 아이콘 | 텍스트 | 배경색 | 텍스트색 |
|------|--------|--------|--------|---------|
| **처리 완료** | 🔒 | 보안 처리 완료 | `#D1FAE5` | `#065F46` |
| **처리 중** | 🔄 | 보안 처리 중... | `#FEF3C7` | `#92400E` |
| **검토 필요** | ⚠️ | 보안 검토 필요 | `#FEE2E2` | `#991B1B` |

### 8.4 글로벌 UI 요소

#### 8.4.1 Toast 알림 명세

| 유형 | 아이콘 | 배경색 | 지속 시간 | 예시 메시지 |
|------|--------|--------|----------|------------|
| **Success** | ✓ | `#D1FAE5` | 3초 | "통화가 완료되었습니다" |
| **Error** | ✕ | `#FEE2E2` | 5초 + dismiss | "SMS 발송에 실패했습니다" |
| **Info** | ℹ | `#DBEAFE` | 3초 | "스크립트가 복사되었습니다" |
| **Warning** | ⚠ | `#FEF3C7` | 5초 | "연결이 불안정합니다" |

#### 8.4.2 FAB (Floating Action Button) 명세

```
┌────────────────────────────────────────────┐
│                                            │
│                           ┌──────────────┐ │
│                           │ ✨ AI 분석   │ │◀─ Primary State
│                           │              │ │   Background: #2563EB
│                           └──────────────┘ │   Text: White
│                                            │
│                           ┌──────────────┐ │
│                           │ ⏳ 분석 중...│ │◀─ Loading State
│                           │              │ │   Background: #9CA3AF
│                           └──────────────┘ │   Text: White
│                                            │
│                           ┌──────────────┐ │
│                           │ ✨ AI 분석   │ │◀─ Disabled State
│                           │              │ │   Background: #E5E7EB
│                           └──────────────┘ │   Text: #9CA3AF
└────────────────────────────────────────────┘

Position: Fixed, Right 24px, Bottom 24px
Size: Width auto (min 120px), Height 48px
Border Radius: 24px
Shadow: 0 4px 12px rgba(0, 0, 0, 0.15)
```

### 8.5 반응형 고려사항

| 브레이크포인트 | 디바이스 | Zone A | Zone B | Zone C |
|---------------|----------|--------|--------|--------|
| ≥1280px | 대형 데스크톱 | 55% 폭 | 45% 폭 고정 | 600px 모달 |
| 1024-1279px | 데스크톱 | 55% 폭 | 45% 폭 고정 | 600px 모달 |
| 768-1023px | 태블릿 | 100% 폭 | 슬라이드 오버 | 전체 화면 모달 |

---

## 9. 데이터 요구사항 및 데이터 흐름 (Data Requirements and Data Flow)

### 9.1 데이터 엔티티 정의

#### 9.1.1 핵심 엔티티

| 엔티티 | 설명 | 주요 속성 |
|--------|------|----------|
| **Session** | 상담 세션 단위 | sessionId, counselorId, customerId, status, startTime, endTime |
| **Transcript** | 개별 발화 기록 | transcriptId, sessionId, speaker, text, isFinal, timestamp |
| **AIAnalysis** | AI 분석 요청/결과 | analysisId, sessionId, query, summary, documents, script, requestTime |
| **CallSummary** | 통화 요약 | summaryId, sessionId, content, isEdited, createdAt |
| **SMSLog** | SMS 발송 기록 | smsId, sessionId, recipient, content, status, sentAt |

#### 9.1.2 보조 엔티티

| 엔티티 | 설명 | 주요 속성 |
|--------|------|----------|
| **Counselor** | 상담사 정보 | counselorId, name, department, role |
| **Customer** | 고객 정보 | customerId, name (masked), phone (masked), lastContact |
| **AuditLog** | 감사 로그 | logId, eventType, actorId, timestamp, details |

### 9.2 데이터 흐름 다이어그램

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                              데이터 흐름도                                   │
└─────────────────────────────────────────────────────────────────────────────┘

┌─────────────┐     ┌─────────────┐     ┌─────────────────────────────────────┐
│   음성      │     │   STT       │     │              클라이언트              │
│   입력      │────▶│   서비스    │────▶│                                     │
└─────────────┘     └─────────────┘     │  ┌───────────────────────────────┐  │
      │                                 │  │         실시간 전사            │  │
      │              WebSocket          │  │    (Interim → Final 전환)      │  │
      │         ◀──────────────────────│  └───────────────────────────────┘  │
      │                                 │                                     │
      │                                 │  ┌───────────────────────────────┐  │
      │                                 │  │        AI 분석 요청            │  │
      │                                 │  │    (PII 마스킹된 컨텍스트)      │  │
      │                                 │  └──────────────┬────────────────┘  │
      │                                 │                 │                   │
      │                                 └─────────────────│───────────────────┘
      │                                                   │
      │                                                   ▼
      │                                 ┌─────────────────────────────────────┐
      │                                 │            백엔드 서버               │
      │                                 │                                     │
      │                                 │  ┌───────────────────────────────┐  │
      │                                 │  │      PII 2차 검증/마스킹       │  │
      │                                 │  └──────────────┬────────────────┘  │
      │                                 │                 │                   │
      │                                 │                 ▼                   │
      │                                 │  ┌───────────────────────────────┐  │
      │                                 │  │       RAG/LLM 서비스 호출      │  │
      │                                 │  └──────────────┬────────────────┘  │
      │                                 │                 │                   │
      │                                 │                 ▼                   │
      │                                 │  ┌───────────────────────────────┐  │
      │                                 │  │         결과 저장              │  │
      │                                 │  │   (Session, AIAnalysis)        │  │
      │                                 │  └──────────────┬────────────────┘  │
      │                                 │                 │                   │
      │                                 └─────────────────│───────────────────┘
      │                                                   │
      │                                                   ▼
      │                                 ┌─────────────────────────────────────┐
      │                                 │            데이터베이스              │
      │                                 │                                     │
      │                                 │  • Sessions                         │
      │                                 │  • Transcripts                      │
      │                                 │  • AIAnalyses                       │
      │                                 │  • CallSummaries                    │
      │                                 │  • SMSLogs                          │
      │                                 │  • AuditLogs                        │
      │                                 │                                     │
      └────────────────────────────────▶│  (최종 영구 저장)                    │
                 통화 종료 시            └─────────────────────────────────────┘
```

### 9.3 데이터 상태 전이

#### 9.3.1 Session 상태 전이

```
    ┌─────────┐      통화 연결       ┌─────────┐
    │ Created │ ───────────────────▶│ Active  │
    └─────────┘                     └────┬────┘
                                         │
                           ┌─────────────┼─────────────┐
                           │             │             │
                      정상 종료     비정상 종료    타임아웃
                           │             │             │
                           ▼             ▼             ▼
                    ┌─────────────┐ ┌─────────────┐ ┌─────────────┐
                    │ Completed   │ │  Aborted    │ │  Expired    │
                    │ (영구저장)  │ │ (24h 후 삭제)│ │ (로그만 저장)│
                    └─────────────┘ └─────────────┘ └─────────────┘
```

#### 9.3.2 Transcript 데이터 전이

```
    ┌─────────────┐     STT 처리      ┌─────────────┐
    │   Audio     │ ─────────────────▶│   Interim   │
    │   Chunk     │                   │  (임시)     │
    └─────────────┘                   └──────┬──────┘
                                             │
                                        확정(isFinal)
                                             │
                                             ▼
                                      ┌─────────────┐
                                      │    Final    │
                                      │  (저장대상) │
                                      └──────┬──────┘
                                             │
                                        세션 완료
                                             │
                                             ▼
                                      ┌─────────────┐
                                      │   Stored    │
                                      │  (DB 저장)  │
                                      └─────────────┘
```

### 9.4 실시간 데이터 요구사항

| 데이터 유형 | 전송 방식 | 지연 허용 | 버퍼링 |
|------------|----------|----------|--------|
| STT Interim | WebSocket Push | <500ms | 클라이언트 500ms 디바운스 |
| STT Final | WebSocket Push | <1s | 없음 |
| AI 분석 결과 | HTTP Response | <10s | 서버 캐싱 가능 |
| 통화 상태 | WebSocket Push | <100ms | 없음 |

### 9.5 데이터 보존 정책

| 데이터 유형 | 보존 기간 | 삭제 조건 | 비고 |
|------------|----------|----------|------|
| Session (완료) | 3년 | 법적 요구 충족 후 | 컴플라이언스 요구사항 |
| Session (미완료) | 24시간 | 자동 삭제 | 비정상 종료 케이스 |
| Transcript | 3년 | Session과 동일 | PII 마스킹 상태로 저장 |
| AIAnalysis | 1년 | 분석 품질 개선용 | 익명화 후 장기 보관 가능 |
| SMSLog | 3년 | Session과 동일 | 발송 증빙 |
| AuditLog | 5년 | 보안 감사 요구사항 | 무삭제 원칙 |

---

## 10. 보안 및 개인정보 고려사항 (Security and Privacy Considerations)

### 10.1 PII 처리 체계

#### 10.1.1 PII 식별 및 분류

| PII 유형 | 민감도 | 마스킹 패턴 | 예시 (원본 → 마스킹) |
|----------|--------|------------|---------------------|
| **이름** | 중 | 첫 글자 + ** | 홍길동 → 홍** |
| **전화번호** | 중 | 가운데 4자리 마스킹 | 010-1234-5678 → 010-****-5678 |
| **카드번호** | 상 | 앞 12자리 마스킹 | 1234-5678-9012-3456 → ****-****-****-3456 |
| **주민등록번호** | 상 | 뒤 7자리 마스킹 | 880101-1234567 → 880101-******* |
| **주소** | 중 | 상세주소 마스킹 | 서울시 강남구 테헤란로 123 → 서울시 강남구 *** |
| **계좌번호** | 상 | 가운데 마스킹 | 110-123-456789 → 110-***-***789 |
| **이메일** | 중 | 로컬파트 부분 마스킹 | hong@example.com → h***@example.com |
| **여권번호** | 상 | 뒤 5자리 마스킹 | M12345678 → M123***** |

#### 10.1.2 PII 처리 흐름

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                           PII 처리 흐름                                     │
└─────────────────────────────────────────────────────────────────────────────┘

   원본 데이터                    마스킹 처리                    저장/전송
       │                             │                             │
       ▼                             ▼                             ▼
┌─────────────┐             ┌─────────────────┐             ┌─────────────┐
│  STT 결과   │             │  프론트엔드     │             │   AI 서비스  │
│ (원본 텍스트)│────────────▶│  1차 마스킹     │────────────▶│ (마스킹된   │
│             │             │  (정규식)       │             │  데이터만)  │
└─────────────┘             └────────┬────────┘             └─────────────┘
                                     │
                                     ▼
                            ┌─────────────────┐
                            │   백엔드        │
                            │   2차 검증      │
                            │   (재마스킹)    │
                            └────────┬────────┘
                                     │
                    ┌────────────────┼────────────────┐
                    │                │                │
                    ▼                ▼                ▼
             ┌─────────────┐  ┌─────────────┐  ┌─────────────┐
             │   DB 저장   │  │  로그 기록  │  │  SMS 발송   │
             │ (마스킹됨)  │  │ (마스킹됨)  │  │ (원본 필요시│
             │             │  │             │  │ 서버에서만) │
             └─────────────┘  └─────────────┘  └─────────────┘
```

### 10.2 인증 및 권한 관리

#### 10.2.1 인증 체계

| 구성 요소 | 설명 | 유효 기간 |
|----------|------|----------|
| **Access Token** | JWT 기반, API 요청 인증 | 30분 |
| **Refresh Token** | Access Token 갱신용 | 8시간 (근무 시간) |
| **Session ID** | WebSocket 연결 식별 | 통화 세션 동안 |

#### 10.2.2 JWT 토큰 구조

```json
{
  "header": {
    "alg": "RS256",
    "typ": "JWT"
  },
  "payload": {
    "sub": "counselor-uuid-12345",
    "name": "김상담",
    "role": "counselor",
    "department": "고객서비스팀",
    "iat": 1705312800,
    "exp": 1705314600,
    "jti": "unique-token-id"
  }
}
```

#### 10.2.3 권한 매트릭스

| 기능 | 상담사 | 슈퍼바이저 | 관리자 |
|------|--------|-----------|--------|
| 본인 통화 처리 | ✅ | ✅ | ✅ |
| AI 분석 요청 | ✅ | ✅ | ✅ |
| 본인 통화 이력 조회 | ✅ | ✅ | ✅ |
| 팀원 통화 이력 조회 | ❌ | ✅ | ✅ |
| 전체 통화 이력 조회 | ❌ | ❌ | ✅ |
| 시스템 설정 변경 | ❌ | ❌ | ✅ |
| 감사 로그 조회 | ❌ | ❌ | ✅ |

### 10.3 데이터 암호화

| 데이터 상태 | 암호화 방식 | 알고리즘 |
|------------|------------|----------|
| **전송 중 (In Transit)** | TLS | TLS 1.3 |
| **저장 시 (At Rest)** | 필드 레벨 암호화 | AES-256-GCM |
| **백업** | 전체 암호화 | AES-256 |

### 10.4 감사 로깅

#### 10.4.1 로깅 대상 이벤트

| 이벤트 유형 | 로깅 내용 | 보존 기간 |
|------------|----------|----------|
| **로그인/로그아웃** | 상담사 ID, 시간, IP, 결과 | 5년 |
| **세션 시작/종료** | 세션 ID, 상담사 ID, 시간, 종료 사유 | 5년 |
| **AI 분석 요청** | 세션 ID, 쿼리 (마스킹), 시간 | 3년 |
| **SMS 발송** | 세션 ID, 수신번호 (마스킹), 결과 | 3년 |
| **데이터 조회** | 조회자 ID, 조회 대상, 시간 | 5년 |
| **설정 변경** | 변경자 ID, 변경 내용, 시간 | 5년 |
| **보안 이벤트** | 이벤트 유형, 상세 내용, 시간 | 무기한 |

#### 10.4.2 로그 형식

```json
{
  "timestamp": "2024-01-15T10:30:45.123Z",
  "level": "INFO",
  "eventType": "AI_ANALYSIS_REQUEST",
  "actorId": "counselor-uuid-12345",
  "actorName": "김상담",
  "sessionId": "session-uuid-67890",
  "details": {
    "query": "카드 분실 신고 절차",
    "contextTurns": 10,
    "piiMasked": true
  },
  "clientIp": "192.168.1.100",
  "userAgent": "Mozilla/5.0..."
}
```

### 10.5 보안 상태 시각화

| 상태 | 의미 | UI 표현 | 상담사 행동 |
|------|------|---------|------------|
| **🔒 Secured** | PII 처리 완료, 안전 상태 | 녹색 배지 | 정상 진행 |
| **🔄 Processing** | PII 처리 진행 중 | 노란색 배지 + 로딩 | 대기 |
| **⚠️ Review Required** | 수동 검토 필요 | 빨간색 배지 + 경고 | 내용 확인 후 진행 |

### 10.6 컴플라이언스 준비 사항

| 규정/표준 | 관련 요구사항 | 대응 방안 |
|----------|--------------|----------|
| **ISMS** | 정보보호 관리체계 | 접근통제, 암호화, 로깅 구현 |
| **개인정보보호법** | 개인정보 처리 제한 | PII 마스킹, 최소 수집, 동의 관리 |
| **전자금융거래법** | 금융정보 보호 | 암호화, 접근통제, 거래 로깅 |
| **SOC 2** | 보안/가용성/기밀성 | 감사 로그, 접근 제어, 암호화 |

### 10.7 보안 체크리스트

| 영역 | 체크 항목 | 상태 |
|------|----------|------|
| **인증** | JWT 토큰 만료 시간 적절 | ☐ |
| | 리프레시 토큰 안전하게 저장 | ☐ |
| | 동시 로그인 제어 구현 | ☐ |
| **PII** | 프론트엔드 마스킹 구현 | ☐ |
| | 백엔드 재검증 구현 | ☐ |
| | 마스킹 패턴 정규식 테스트 완료 | ☐ |
| **전송** | TLS 1.3 적용 | ☐ |
| | WebSocket 보안 연결 (wss) | ☐ |
| **저장** | 필드 레벨 암호화 구현 | ☐ |
| | 백업 암호화 구현 | ☐ |
| **로깅** | 감사 로그 구현 | ☐ |
| | 로그 무결성 보장 | ☐ |
| **접근제어** | RBAC 구현 | ☐ |
| | 최소 권한 원칙 적용 | ☐ |

---

## 부록: 용어 정의

| 용어 | 정의 |
|------|------|
| **UC (Use Case)** | 유스케이스, 사용자와 시스템 간 상호작용 시나리오 |
| **AF (Alternative Flow)** | 대안 흐름, 주요 흐름에서 분기되는 대체 경로 |
| **EX (Exception)** | 예외 케이스, 오류 상황에 대한 처리 |
| **BR (Business Rule)** | 비즈니스 규칙, 시스템이 준수해야 할 규정 |
| **PC (Precondition)** | 사전조건, 유스케이스 실행 전 충족 필요 조건 |
| **PO (Postcondition)** | 사후조건, 유스케이스 완료 후 보장 상태 |
| **PII** | 개인식별정보 (Personally Identifiable Information) |
| **STT** | 음성-텍스트 변환 (Speech-to-Text) |
| **RAG** | 검색 증강 생성 (Retrieval-Augmented Generation) |
| **FAB** | 플로팅 액션 버튼 (Floating Action Button) |
| **JWT** | JSON 웹 토큰 (JSON Web Token) |

---

**문서 버전:** 1.0  
**최종 수정일:** 2025년 1월  
**작성자:** AI 기반 유스케이스 설계 시스템  
**검토 필요:** CTO, 보안팀, QA팀, UX팀